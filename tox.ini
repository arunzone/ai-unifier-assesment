# Tox configuration file
# Run tests, linting, and formatting in isolated environments

[tox]
minversion = 3.24
envlist = default
isolated_build = True

[testenv]
description = Run tests with linting and type checking
setenv =
    TOXINIDIR = {toxinidir}
    PYTHONDONTWRITEBYTECODE = 1
    PYTHONPATH = {toxinidir}
    PYTHONTRACEMALLOC=1
passenv =
    HOME
    SETUPTOOLS_*
extras =
    testing
commands =
    ruff check .
    ruff format --check .
    mypy src
    pytest --junitxml=build/pytest.xml -vv --tb=native --random-order --cov ai_unifier_assesment --cov-fail-under=100 --cov-report term-missing --cov-report xml --cov-config=.coveragerc -W error {posargs}

[testenv:format]
description = Format code with ruff
changedir = {toxinidir}
extras =
    testing
commands =
    ruff format .
    ruff check --fix .

[testenv:test]
description = Run tests only
extras =
    testing
commands =
    pytest {posargs}

[testenv:{build,clean}]
description =
    build: Build the package
    clean: Remove build artifacts
skip_install = True
changedir = {toxinidir}
deps =
    build: build[virtualenv]
commands =
    clean: python -c 'import shutil; [shutil.rmtree(p, True) for p in ("build", "dist")]'
    clean: python -c 'import pathlib, shutil; [shutil.rmtree(p, True) for p in pathlib.Path("src").glob("*.egg-info")]'
    build: python -m build {posargs}
